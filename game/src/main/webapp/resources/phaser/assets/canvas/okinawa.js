// -- user code here --

/* --- start generated code --- */

// Generated by  1.5.1 (Phaser v2.6.2)

/**
 * okinawa.
 */
function okinawa() {
	Phaser.State.call(this);
}

/** @type Phaser.State */
var okinawa_proto = Object.create(Phaser.State.prototype);
okinawa.prototype = okinawa_proto;
okinawa.prototype.constructor = okinawa;

okinawa.prototype.init = function() {
	this.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
	this.scale.pageAlignHorizontally = true;
	this.scale.pageAlignVertically = true;
	this.stage.backgroundColor = '#ffffff';
	current_spot = "okinawa";
};

/** 사진 */
var ok_Amerika; 				// 아메리카빌리지 사진
var ok_shuri; 					// 슈리성 사진
var ok_manjamo; 				// 만자모 사진
var ok_kouri; 					// 코우리 사진
var ok_pine; 					// 파인애플 사진

/** 좌표버튼 */
var shuri_btn; 					// 슈리성 좌표버튼
var amevil_btn;					// 아미리카빌리지 좌표버튼
var manzam_btn; 				// 만자보 좌표버튼
var koutri_btn;					// 코우리좌표버튼
var pineap_btn; 				// 파인애플좌표버튼

/** 확대 사진 */
var shuri_zum; 					// 슈리성확대
var amevil_zum;					// 아메이라확대
var manzam_zum; 				// 만자모확대
var kouri_zum; 					// 코우리확대
var pineap_zum;					// 파인애플확대

/** 각각 관광지 이미지의 확대여부에 대한 변수 */
var shuri_iszum = null;
var amevil_iszum = null;
var manzam_iszum = null;
var kouri_iszum = null;
var pineap_iszum = null;

/** 기타 소재 */
var ok_toStore; 					// 상점이동버튼
var oki_confmove; 				// 페이지 이동시 묻는 창
var oki_yesbtn;
var oki_nobtn;
var oki_msgwrite;
var oki_bgm;					// 배경음악

/** 별점 표현 */
var stars;						// 그룹별
var samount;					// 남은 별 갯수
var ok_smax = 3;				// 최대 별 갯수

/** 지표 클릭 여부 확인 - 페이지 이동 Flag */
var shuri_clicked = false;		// 슈리성 
var america_clicked = false;	// 아메리카 빌리지
var kouri_clicked = false;		// 코우리
var manzamo_clicked = false;	// 만자모
var pineapple_clicked = false;	// 파인애플 파크

okinawa.prototype.create = function() {
	var okinawaMap = this.add.sprite(-6.0, -7.0, 'okinawaMap');
	okinawaMap.scale.setTo(1.9687805622336685, 1.5220000469064325);

	// 상점이동 버튼
	ok_toStore = this.game.add.button(598.0, 400.0, 'btn_store', ok_gotoStore, this, 0, 1, 0, 1);
	ok_toStore.inputEnabled = true; // 텍스트가 클릭(이벤트)에 반응하도록 만든다.

	// bgm
	oki_bgm = this.add.audio('SelectArea');
	oki_bgm.play();
	oki_bgm.loopFull();
	
	ok_exit = this.game.add.button(1.0, 1.0, 'store_exit',ok_goJapanMap, this, 0, 1, 0, 1);
	ok_exit.scale.setTo(0.4, 0.4);
	ok_exit.inputEnabled=true;
	ok_exit.input.useHandCursor=true;

	/** 각 지표이미지 설정 */
	// 슈리성 
	shuri_btn = this.game.add.button(this.game.world.centerX - 270,384, 'ok_sc_click', thumbShuri, this, 2, 1, 0);
	shuri_btn.scale.setTo(0.3643749177815376, 0.36999987634909814);
	shuri_btn.input.useHandCursor = true;

	// 아메리카빌리지
	amevil_btn = this.game.add.button(this.game.world.centerX - 180,250, 'ok_av_click', thumbAmerica, this, 2, 1, 0);
	amevil_btn.scale.setTo(0.3643749177815376, 0.36999987634909814);
	amevil_btn.input.useHandCursor = true;

	// 만자모 
	manzam_btn = this.game.add.button(this.game.world.centerX - 70,250, 'ok_mj_click', thumbManzamo, this, 2, 1, 0);
	manzam_btn.scale.setTo(0.3643749177815376, 0.36999987634909814);
	manzam_btn.input.useHandCursor = true;

	// 코우리 
	koutri_btn = this.game.add.button(this.game.world.centerX+10,180, 'ok_kb_click', thumbKouri, this, 2, 1, 0);
	koutri_btn.scale.setTo(0.3643749177815376, 0.36999987634909814);
	koutri_btn.input.useHandCursor = true;

	// 파인애플
	pineap_btn = this.game.add.button(this.game.world.centerX +120,230, 'ok_pp_click', thumbPineapple, this, 2, 1, 0);
	pineap_btn.scale.setTo(0.3643749177815376, 0.36999987634909814);
	pineap_btn.input.useHandCursor = true;

	/** 각 관광지 확대 사진 설정 */
	// 슈리성
	ok_shuri = this.game.add.sprite(this.game.world.centerX - 290, 331, 'ok_sc_thumb');
	ok_shuri.scale.setTo(0.1, 0.1); // 슈리상 사진 캔버스에 배치한거 안보이게
	ok_shuri.visible = false;

	// 아메리카빌리지
	ok_Amerika = this.game.add.sprite(this.game.world.centerX - 200,222, 'ok_av_thumb');
	ok_Amerika.scale.setTo(0.1, 0.1);
	ok_Amerika.visible = false;
	
	// 만자모
	ok_manjamo = this.add.sprite(this.game.world.centerX -80,212, 'ok_mj_thumb');
	ok_manjamo.scale.setTo(0.1, 0.1);
	ok_manjamo.visible = false;

	// 코우리
	ok_kouri = this.game.add.sprite(this.game.world.centerX +5,128, 'ok_kb_thumb');
	ok_kouri.scale.setTo(0.1, 0.1);
	ok_kouri.visible = false; 

	// 파인애플
	ok_pine = this.game.add.sprite(this.game.world.centerX +120,205, 'ok_pp_thumb');
	ok_pine.scale.setTo(0.1, 0.1);
	ok_pine.visible = false;

	/** 클릭시 사진 확대 및 팝업 좌표 설정 */
	// 슈리성
	shuri_zum = this.game.add.sprite(this.game.world.centerX, this.game.world.centerY, 'ok_sc_thumb');
	shuri_zum.alpha = 0.8;
	shuri_zum.anchor.set(0.5);
	shuri_zum.inputEnabled = true;
	shuri_zum.events.onInputDown.add(shuriZoom, this);
	shuri_zum.scale.set(0.5);  //확대사진 사이즈
	shuri_zum.visible = false;

	// 아메리카빌리지
	amevil_zum = this.game.add.sprite(this.game.world.centerX, this.game.world.centerY, 'ok_av_thumb');
	amevil_zum.alpha = 0.8;
	amevil_zum.anchor.set(0.5);
	amevil_zum.inputEnabled = true;
	amevil_zum.events.onInputDown.add(americaZoom, this);
	amevil_zum.scale.set(0.5); // 확대사진 사이즈
	amevil_zum.visible = false;

	// 만자모
	manzam_zum = this.game.add.sprite(this.game.world.centerX, this.game.world.centerY, 'ok_mj_thumb');
	manzam_zum.alpha = 0.8;
	manzam_zum.anchor.set(0.5);
	manzam_zum.inputEnabled = true;
	manzam_zum.events.onInputDown.add(manzamoZoom, this);
	manzam_zum.scale.set(0.5); //확대사진 사이즈
	manzam_zum.visible = false;

	// 코우리
	kouri_zum = this.game.add.sprite(this.game.world.centerX, this.game.world.centerY, 'ok_kb_thumb');
	kouri_zum.alpha = 0.8;
	kouri_zum.anchor.set(0.5);
	kouri_zum.inputEnabled = true;
	kouri_zum.events.onInputDown.add(kouriZoom, this);
	kouri_zum.scale.set(0.5); //확대사진 사이즈
	kouri_zum.visible = false;

	// 파인애플 파크
	pineap_zum = this.game.add.sprite(this.game.world.centerX, this.game.world.centerY, 'ok_pp_thumb');
	pineap_zum.alpha = 0.8;
	pineap_zum.anchor.set(0.5);
	pineap_zum.inputEnabled = true;
	pineap_zum.events.onInputDown.add(pineappleZoom, this);
	pineap_zum.scale.set(0.5); //확대사진 사이즈
	pineap_zum.visible = false;
	
	/** 기타 소재 설정 */
	// 메세지 창
	oki_confmove = this.add.sprite(144.0, 322.0, 'popup');
	oki_confmove.scale.setTo(1.5, 1.0);
	oki_confmove.alpha = 0.7;
	oki_confmove.visible = false;
	
	// 아니오 버튼
	oki_nobtn = this.game.add.button(500.0, 380.0, 'btn_nope', cancel, this, 0, 1, 0, 1);
	oki_nobtn.scale.setTo(0.5, 0.5);
	oki_nobtn.inputEnabled = true;
	oki_nobtn.visible = false;
	
	// 네 버튼
	oki_yesbtn = this.game.add.button(415.0, 380.0, 'btn_yes', ok_changePlace, this, 0, 1, 0, 1);
	oki_yesbtn.scale.setTo(0.5, 0.5);
	oki_yesbtn.inputEnabled = true;
	oki_yesbtn.visible = false;
	
	// 메세지
	oki_msgwrite = this.add.text(180, 350, '', {font : "bold 25px Arial", fill : "#000000", align : "left"});
	
	// 별 그룹
	stars =  this.add.group();	

	/** 각 관광지 지표에 별점 찍기 */ 
	// 별의 갯수는 3최대개 /  60점 미만이면 빈 별만 3개
	//슈리성	
	if (ok_sc_rs >= 60) {
		samount = Math.round(ok_sc_rs - 60) / 10;
		if (samount > 3 && samount <= 4) {
			samount = 3;
		} else if (samount > 0 && samount <= 3) {
			samount = Math.round(ok_sc_rs - 60) / 10;
		} else {
			samount = 0;
		}
		for (var i = 0; i < samount; i++) {
			var starr = stars.create(130 + (i * 30), 360, 'stars(36x36)', 0);
			starr.scale.setTo(0.7, 0.7);
		}
		for (var i = 0; i < ok_smax - samount; i++) {
			var starr = stars.create(190 - (i * 30), 360, 'stars(36x36)', 1);
			starr.scale.setTo(0.7, 0.7);
		}
	} else if (ok_sc_rs < 60) {
		// 60점 밑이면 빈별세개찍히게
		for (var i = 0; i < 3; i++) {
			var starr = stars.create(190 - (i * 30), 360, 'stars(36x36)', 1);
			starr.scale.setTo(0.7, 0.7);
		}
	}
	
	// 아메리카빌리지
	if (ok_av_rs >= 60) {
		samount = Math.round(ok_av_rs - 60) / 10;
		if (samount > 3 && samount <= 4) {
			samount = 3;
		} else if (samount > 0 && samount <= 3) {
			samount = Math.round(ok_av_rs - 60) / 10;
		} else {
			samount = 0;
		}
		for (var i = 0; i < samount; i++) {
			var starr = stars.create(220 + (i * 30), 220, 'stars(36x36)', 0);
			starr.scale.setTo(0.7, 0.7);
		}
		for (var i = 0; i < ok_smax - samount; i++) {
			var starr = stars.create(280 - (i * 30), 220, 'stars(36x36)', 1);
			starr.scale.setTo(0.7, 0.7);
		}
	} else if (ok_av_rs < 60) {
		for (var i = 0; i < 3; i++) {
			var starr = stars.create(280 - (i * 30), 220, 'stars(36x36)', 1);
			starr.scale.setTo(0.7, 0.7);
		}
	}
	
	// 만좌모
	if (ok_mj_rs >= 60) {
		samount = Math.round(ok_mj_rs - 60) / 10;
		if (samount > 3 && samount <= 4) {
			samount = 3;
		} else if (samount > 0 && samount <= 3) {
			samount = Math.round(ok_mj_rs - 60) / 10;
		} else {
			samount = 0;
		}
		for (var i = 0; i < samount; i++) {
			var starr = stars.create(330 + (i * 30), 220, 'stars(36x36)', 0);
			starr.scale.setTo(0.7, 0.7);
		}
		for (var i = 0; i < ok_smax - samount; i++) {
			var starr = stars.create(390 - (i * 30), 220, 'stars(36x36)', 1);
			starr.scale.setTo(0.7, 0.7);
		}
	} else if (ok_mj_rs < 60) {
		for (var i = 0; i < 3; i++) {
			var starr = stars.create(390 - (i * 30), 220, 'stars(36x36)', 1);
			starr.scale.setTo(0.7, 0.7);
		}
	}
	
	// 코우리
	if (ok_kb_rs >= 60) {
		samount = Math.round(ok_kb_rs - 60) / 10;
		if (samount > 3 && samount <= 4) {
			samount = 3;
		} else if (samount > 0 && samount <= 3) {
			samount = Math.round(ok_kb_rs - 60) / 10;
		} else {
			samount = 0;
		}
		for (var i = 0; i < samount; i++) {
			var starr = stars.create(410 + (i * 30), 150, 'stars(36x36)', 0);
			starr.scale.setTo(0.7, 0.7);
		}
		for (var i = 0; i < ok_smax - samount; i++) {
			var starr = stars.create(470 - (i * 30), 150, 'stars(36x36)', 1);
			starr.scale.setTo(0.7, 0.7);
		}
	} else if (ok_kb_rs < 60) {
		for (var i = 0; i < 3; i++) {
			var starr = stars.create(470 - (i * 30), 150, 'stars(36x36)', 1);
			starr.scale.setTo(0.7, 0.7);
		}
	}
	
	// 파인애플
	if (ok_pp_rs >= 60) {
		samount = Math.round(ok_pp_rs - 60) / 10;
		if (samount > 3 && samount <= 4) {
			samount = 3;
		} else if (samount > 0 && samount <= 3) {
			samount = Math.round(ok_pp_rs - 60) / 10;
		} else {
			samount = 0;
		}
		for (var i = 0; i < samount; i++) {
			var starr = stars.create(530 + (i * 30), 200, 'stars(36x36)', 0);
			starr.scale.setTo(0.7, 0.7);
		}
		for (var i = 0; i < ok_smax - samount; i++) {
			var starr = stars.create(590 - (i * 30), 200, 'stars(36x36)', 1);
			starr.scale.setTo(0.7, 0.7);
		}
	} else if (ok_pp_rs < 60) {
		for (var i = 0; i < 3; i++) {
			var starr = stars.create(590 - (i * 30), 200, 'stars(36x36)', 1);
			starr.scale.setTo(0.7, 0.7);
		}
	}
};

/* --- end generated code --- */
// -- user code here --

/** 해당 지표를 클릭하면 확대 사진을 보여주는 함수 */
function thumbShuri() {
	shuri_zum.visible = true;
	ok_shuri.visible = false;
	amevil_btn.visible = false;
	manzam_btn.visible = false;
	koutri_btn.visible = false;
	pineap_btn.visible = false;
	stars.visible = false;

	// 위에있는 popup 사이즈와 같게 해줘야한다.
	if ((shuri_iszum !== null && shuri_iszum.isRunning) || shuri_zum.scale.x === 0.5 && shuri_zum.scale.y === 0.5) {
		return;
	}
	shuri_iszum = this.game.add.shuri_iszum(shuri_zum.scale).to({x : 0.5, y : 0.8}, 1000, Phaser.Easing.Elastic.Out, true);
}

function thumbAmerica() {
	amevil_zum.visible = true;
	ok_Amerika.visible = false;
	shuri_btn.visible = false;
	manzam_btn.visible = false;
	koutri_btn.visible = false;
	pineap_btn.visible = false;
	stars.visible = false;
	
	if ((amevil_iszum !== null && amevil_iszum.isRunning) || amevil_zum.scale.x === 0.5) {
		return;
	}
	amevil_iszum = this.game.add.amevil_iszum(amevil_zum.scale).to({x : 1, y : 1}, 1000, Phaser.Easing.Elastic.Out, true);
}

function thumbManzamo() {
	manzam_zum.visible = true;
	ok_manjamo.visible = false;
	shuri_btn.visible = false;
	amevil_btn.visible = false;
	koutri_btn.visible = false;
	pineap_btn.visible = false;
	stars.visible = false;
	
	if ((manzam_iszum !== null && manzam_iszum.isRunning) || manzam_zum.scale.x === 0.5 && manzam_zum.scale.y === 0.5) {
		return;
	}
	manzam_iszum = this.game.add.manzam_iszum(manzam_zum.scale).to({x : 1,	y : 1}, 1000, Phaser.Easing.Elastic.Out, true);
}

function thumbKouri() {
	kouri_zum.visible = true;
	ok_kouri.visible = false;
	shuri_btn.visible = false;
	amevil_btn.visible = false;
	manzam_btn.visible = false;
	pineap_btn.visible = false;
	stars.visible = false;
	
	if ((kouri_iszum !== null && kouri_iszum.isRunning) || kouri_zum.scale.x === 0.5) {
		return;
	}
	kouri_iszum = this.game.add.kouri_iszum(kouri_zum.scale).to({x : 1, y : 1}, 1000, Phaser.Easing.Elastic.Out, true);
}

function thumbPineapple() {
	pineap_zum.visible = true;
	shuri_btn.visible = false;
	amevil_btn.visible = false;
	manzam_btn.visible = false;
	koutri_btn.visible = false;
	stars.visible = false;
	
	if ((pineap_iszum !== null && pineap_iszum.isRunning) || pineap_zum.scale.x === 0.5 || pineap_zum.scale.y === 0.5) {
		return;
	}
	pineap_iszum = this.game.add.pineap_iszum(pineap_zum.scale).to({x : 1, y : 1}, 1000, Phaser.Easing.Elastic.Out, true);
}

/** 확대사진 클릭시 메시지창 보여주는 함수 */
function shuriZoom(item) {
	episodeKey = 'ok_sc';
	oki_confmove.visible = true;
	oki_msgwrite.visible = true;
	oki_nobtn.visible = true;
	oki_yesbtn.visible = true;
	if (item.x == this.game.world.centerX && item.y == this.game.world.centerY) {
		shuri_clicked = true;
		shuri_zum.visible = false;
		oki_msgwrite.setText("首里城に行きましょう！", true);
	} 
	else {
		shuri_zum.visible = false;
		ok_shuri.visible = true;
	}
}

function americaZoom(item) {
	episodeKey = 'ok_av';
	oki_confmove.visible = true;
	oki_msgwrite.visible = true;
	oki_nobtn.visible = true;
	oki_yesbtn.visible = true;
	if (item.x == this.game.world.centerX && item.y == this.game.world.centerY) {
		america_clicked =  true;
		amevil_zum.visible = false;
		oki_msgwrite.setText("アメリカンビレッジに\n行きましょう！", true);
	} 
	else {
		amevil_zum.visible = false;
		ok_Amerika.visible = true;
	}
}

function manzamoZoom(item) {
	episodeKey = 'ok_mj';
	oki_confmove.visible = true;
	oki_msgwrite.visible = true;
	oki_nobtn.visible = true;
	oki_yesbtn.visible = true;
	if (item.x == this.game.world.centerX && item.y == this.game.world.centerY) {
		manzamo_clicked =  true;
		manzam_zum.visible = false;
		oki_msgwrite.setText("万座毛に行きましょう！", true);
	} 
	else {
		manzam_zum.visible = false;
		ok_manjamo.visible = true;
	}
}

function kouriZoom(item) {
	episodeKey = 'ok_kb';
	oki_confmove.visible = true;
	oki_msgwrite.visible = true;
	oki_nobtn.visible = true;
	oki_yesbtn.visible = true;
	if (item.x == this.game.world.centerX && item.y == this.game.world.centerY) {
		kouri_clicked =  true;
		kouri_zum.visible = false;
		oki_msgwrite.setText("古宇利に行きましょう！", true);
	} 
	else {
		kouri_zum.visible = false;
		ok_kouri.visible = true;
	}
}

function pineappleZoom(item) {
	episodeKey = 'ok_pp';
	oki_confmove.visible = true;
	oki_msgwrite.visible = true;
	oki_nobtn.visible = true;
	oki_yesbtn.visible = true;
	if (item.x == this.game.world.centerX && item.y == this.game.world.centerY) {
		pineapple_clicked =  true;
		pineap_zum.visible = false;
		oki_msgwrite.setText("ナゴパイナップルパークに\n行きましょう！", true);
	} 
	else {
		pineap_zum.visible = false;
		ok_pine.visible = true;
	}
}

/* no 버튼 눌렀을 때 */
function cancel() {
	oki_confmove.visible = false;
	oki_msgwrite.visible = false;
	oki_yesbtn.visible = false;
	oki_nobtn.visible = false;
	shuri_btn.visible = true;
	amevil_btn.visible = true;
	manzam_btn.visible = true;
	koutri_btn.visible = true;
	pineap_btn.visible = true;
	stars.visible = true;
}

/* yes버튼 눌렀을 때 페이지 이동 함수 */
function ok_changePlace(){
	oki_bgm.pause();
	oki_bgm.destroy(true);
	stageName = "沖縄";
	if (shuri_clicked == true) {
		this.game.state.start("ok_pp");
	} 
	else if(america_clicked == true) {
		this.game.state.start("ok_pp");
	}
	else if(kouri_clicked == true){
		this.game.state.start("ok_pp");
	}
	else if(manzamo_clicked == true){
		this.game.state.start("ok_pp");
	}
	else if(pineapple_clicked == true){
		this.game.state.start("ok_pp");
	}
	else{
		this.game.state.start("japanMap");
	}
}

function ok_goJapanMap(){
	oki_bgm.pause();
	oki_bgm.destroy(true);
	this.game.state.start("japanMap");
}

// 상점이동페이지
function ok_gotoStore() {
	oki_bgm.pause();
	oki_bgm.destroy(true);
	this.game.state.start("store");
}
